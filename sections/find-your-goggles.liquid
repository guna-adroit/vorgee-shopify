<style>
    .find-my-goggles{
        position: relative;
    }
    .vorgee-find-goggles-bg-container{
        width: 100%;
        height: 100vh;
        position: relative;
    }
    .vorgee-find-goggles-bg-container img{
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .vorgee-find-goggles-bg-container::before {
        content: '';
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.3);
        z-index: 6;
    }
    .vorgee-find-goggles-form-container{
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.3);
        z-index: 7;
    }
    .vorgee-find-goggles-form-container label{
        color: white;
        font-size: 30px;
    }
    .vorgee-find-goggles-form-container select{
        font-size: 30px;
        background-color: transparent;
        color: white;
        border: none;
    }
    .vorgee-find-goggles-form-container select option{
        color: black;
        font-size: 16px;
        font-family: 'boxed', sans-serif !important;
        background: white;
    }
    .vorgee-find-goggles-form {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 20px;
        max-width: 100rem;
        margin-left: 4rem;
        margin-right: 4rem;
        height: 100%;
    }
    .find-my-goggles-field{
        display: flex;
        gap: 25px;
        align-items: center;
        cursor: pointer;
    }
    .find-my-goggles-field label{
        width: 30%;
        text-align: right;
    }
    .find-my-goggles-field select{
        width: 70%;
        vertical-align: middle;
        font-weight: 600 !important;
        appearance: none;
        background: 0;
        color: #FFF;
        height: auto;
        font-weight: 400;
        padding: .25em 1em .25em 0;
    }
    .find-my-goggles-field select:focus{
        outline: none;
    }
    button#goggles-submit {
        max-width: fit-content;
        margin: 0 auto;
        padding: 15px 55px;
        border: none;
        cursor: pointer;
        margin-top: 20px;
    }
    button#goggles-submit:hover{
        background-color: rgb(115, 190, 196);
        color: rgb(255, 255, 255);
    }
    .find-my-goggles-results {
        margin: 60px 0;
    }
    .find-my-goggles-result-title-container{
      text-align: center;
    }
    .find-my-goggles-result-title-container h2{
      margin: 0;
    }
    #no-results {
      display: none;
      text-align: center;
      color: white;
      font-size: 24px;
      margin-top: 20px;
    }

    .goggles-block {
    scroll-margin-top: 125px;
  }
  .goggles-block.hidden {
    display: none;
  }
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  .product-card {
    border: 1px solid #eee;
    padding: 10px;
    text-align: center;
  }
  .product-card img {
    max-width: 100%;
    height: auto;
  }
  .custom-dropdown {
    position: relative;
    width: 70%;
  }

  .custom-dropdown-toggle {
    width: 100%;
    padding: .25em 1em .25em 0;
    background: transparent;
    color: #fff;
    border: none;
    border-bottom: 2px solid #fff;
    font-size: 28px;
    text-align: left;
    cursor: pointer;
  }

  .custom-dropdown-toggle::after {
    content: "▼";
    float: right;
    font-size: 18px;
  }

  .custom-dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    color: black;
    border-radius: 4px;
    z-index: 100;
    max-height: 240px;
    overflow-y: auto;
  }

  .custom-dropdown-menu button {
    display: block;
    width: 100%;
    text-align: left;
    background: none;
    border: none;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
  }

  .custom-dropdown-menu button:hover {
    background: #eee;
  }

  .custom-dropdown.open .custom-dropdown-menu {
    display: block;
  }
    @media screen and (max-width: 768px){
        .custom-dropdown{
            width: 100%;
        }
        .custom-dropdown-toggle{
            font-size: 16px;
        }
        .find-my-goggles-field{
            flex-direction: column;
            gap: 2px;
        }
        .vorgee-my-goggles-bg-container{
            height: calc(100vh - 155px);
        }
        .find-my-goggles-field label, .find-my-goggles-field select{
            width: 100%;
            text-align: left;
            font-size: 16px;
        }
        .vorgee-find-goggles-form {
            margin: 0 1.5rem;
        }
        .vorgee-find-goggles-form {
            gap: 32px;
        }
    }
</style>

{% paginate shop.metaobjects['find_my_goggles'].values by 200 %}
{% assign zone_mappings = shop.metaobjects['find_my_goggles'].values %}

<div id="find-my-goggles" class="find-my-goggles">
  <div class="vorgee-find-goggles-bg-container">
    <img src="https://cdn.shopify.com/s/files/1/0662/3136/9798/files/Find_Your_Zone_Quiz_Background.png?v=1759749224" width="" height="" alt="">
  </div>

  <div class="vorgee-find-goggles-form-container section section--page-width">
    

<form class="vorgee-find-goggles-form">

  <!-- Swim Zone -->
  <div class="find-my-goggles-field">
    <label>What’s your swim zone?</label>
    <div class="custom-dropdown" data-name="swimzone">
      <button type="button" class="custom-dropdown-toggle">-- Select --</button>
      <div class="custom-dropdown-menu">
        <button type="button" data-value="competition">Competition: I need goggles built for speed and performance.</button>
        <button type="button" data-value="fitness">Fitness: I need goggles built for comfort and endurance.</button>
        <button type="button" data-value="junior">Junior: I need goggles built for smaller faces who want to see it all.</button>
      </div>
    </div>
  </div>

  <!-- Fit Preference -->
  <div class="find-my-goggles-field">
    <label>What’s your goggles fit preference?</label>
    <div class="custom-dropdown" data-name="fit">
      <button type="button" class="custom-dropdown-toggle">-- Select --</button>
      <div class="custom-dropdown-menu">
        <button type="button" data-value="snug">Snug: Sleek & low profile. Gasket fits firmly inside the eye socket.</button>
        <button type="button" data-value="mid">Mid: Firm & comfortable. Gasket fits securely inside the eye socket.</button>
        <button type="button" data-value="broad">Broad: Classic & wide. Gasket fits outside the eye socket.</button>
        <button type="button" data-value="mask">Mask: Soft & secure. Gasket fits from brow line to cheek.</button>
      </div>
    </div>
  </div>

  <!-- Swim Environment -->
  <div class="find-my-goggles-field">
    <label>You swim the most in:</label>
    <div class="custom-dropdown" data-name="swim_the_most">
      <button type="button" class="custom-dropdown-toggle">-- Select --</button>
      <div class="custom-dropdown-menu">
        <button type="button" data-value="indoor-pools">Indoor pools</button>
        <button type="button" data-value="outdoor-pools">Outdoor pools</button>
        <button type="button" data-value="open-waters">Open waters</button>
        <button type="button" data-value="any-pool-or-body-of-water">Any pool or body of water</button>
      </div>
    </div>
  </div>

  <button id="goggles-submit" type="button">Find My Goggles</button>
</form>

<p id="no-results" style="display:none; text-align:center; color:white; font-size:24px; margin-top:20px;">No matching goggles found.</p>

  </div>
</div>

<div id="goggles-results" class="find-my-goggles-results section section--page-width">
  {% for mapping in zone_mappings %}
    <div class="goggles-block hidden"
      id="zone-{{ mapping.swim_zone | handleize }}-{{ mapping.goggles_fit | handleize }}-{{ mapping.swim_the_most | handleize }}">
      
      <div class="find-my-goggles-result-title-container">
        <h2><span>Your Perfect Pair Awaits</span></h2>
        <p>The goggles made for your swim style are right here.</p>
      </div>

      {% if mapping.note != blank %}
        <p>{{ mapping.note }}</p>
      {% endif %}

      <div class="products-grid">
        {% for product in mapping.models.value %}
          <div class="product-card">
            <a href="{{ product.url }}">
              {{ product.featured_image | image_url: width: 400 | image_tag }}
              <h3>{{ product.title }}</h3>
              <p>{{ product.price | money }}</p>
            </a>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>
{% endpaginate %}

<script>
document.addEventListener("DOMContentLoaded", function() {
  const resultsContainer = document.getElementById("goggles-results");
  const noResults = document.getElementById("no-results");

  let selections = {
    swimzone: "",
    fit: "",
    swim_the_most: ""
  };

  function normalize(val) {
    return val.toLowerCase().trim().replace(/\s+/g, "-");
  }

  // Toggle dropdowns
  document.querySelectorAll(".custom-dropdown-toggle").forEach(btn => {
    btn.addEventListener("click", function(e) {
      e.stopPropagation();
      const parent = this.closest(".custom-dropdown");
      document.querySelectorAll(".custom-dropdown").forEach(d => {
        if (d !== parent) d.classList.remove("open");
      });
      parent.classList.toggle("open");
    });
  });

  // Select option
  document.querySelectorAll(".custom-dropdown-menu button").forEach(option => {
    option.addEventListener("click", function() {
      const parentDropdown = this.closest(".custom-dropdown");
      const toggle = parentDropdown.querySelector(".custom-dropdown-toggle");
      const name = parentDropdown.dataset.name;
      const value = this.dataset.value;

      toggle.textContent = this.textContent;
      parentDropdown.classList.remove("open");

      selections[name] = value;
      showProducts();
    });
  });

  // Close dropdown when clicking outside
  document.addEventListener("click", function() {
    document.querySelectorAll(".custom-dropdown").forEach(d => d.classList.remove("open"));
  });

  function showProducts() {
    const { swimzone, fit, swim_the_most } = selections;

    resultsContainer.querySelectorAll(".goggles-block").forEach(el => el.classList.add("hidden"));
    noResults.style.display = "none";

    if (!swimzone || !fit || !swim_the_most) return;

    const targetId = `zone-${normalize(swimzone)}-${normalize(fit)}-${normalize(swim_the_most)}`;
    console.log("Looking for:", targetId);
    const targetEl = document.getElementById(targetId);

    if (targetEl) {
      targetEl.classList.remove("hidden");
      targetEl.scrollIntoView({ behavior: "smooth" });
    } else {
      noResults.style.display = "block";
    }
  }

  // Also trigger manually on button click
  document.getElementById("goggles-submit").addEventListener("click", function(e) {
    e.preventDefault();
    showProducts();
  });
});
</script>

{% schema %}
{
  "name": "Find Your Goggles",
  "class": "section-wrapper",
  "tag": "section",
  "settings": [],
  "presets": [
    {
        "name": "Find Your Goggles"
    }
  ]
}
{% endschema %}
